"use strict";!function(){var m={calendars:[],calendarInputs:[],clockInputs:[],clockHours:{default_:[[gettext_noop("Now"),-1],[gettext_noop("Midnight"),0],[gettext_noop("6 a.m."),6],[gettext_noop("Noon"),12],[gettext_noop("6 p.m."),18]]},dismissClockFunc:[],dismissCalendarFunc:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",timezoneWarningClass:"timezonewarning",timezoneOffset:0,init:function(){var e=document.getElementsByTagName("body")[0].getAttribute("data-admin-utc-offset");if(e){var t=-60*(new Date).getTimezoneOffset();m.timezoneOffset=t-e}for(var n=document.getElementsByTagName("input"),a=0;a<n.length;a++){var i=n[a];"text"===i.getAttribute("type")&&i.className.match(/vTimeField/)?(m.addClock(i),m.addTimezoneWarning(i)):"text"===i.getAttribute("type")&&i.className.match(/vDateField/)&&(m.addCalendar(i),m.addTimezoneWarning(i))}},now:function(){var e=document.getElementsByTagName("body")[0].getAttribute("data-admin-utc-offset");if(e){var t=new Date,n=-60*t.getTimezoneOffset();return t.setTime(t.getTime()+1e3*(e-n)),t}return new Date},addTimezoneWarning:function(e){var t=django.jQuery,n=m.timezoneWarningClass,a=m.timezoneOffset/3600;if(a&&!t(e).siblings("."+n).length){var i;i=0<a?ngettext("Note: You are %s hour ahead of server time.","Note: You are %s hours ahead of server time.",a):(a*=-1,ngettext("Note: You are %s hour behind server time.","Note: You are %s hours behind server time.",a)),i=interpolate(i,[a]);var c=t("<span>");c.attr("class",n),c.text(i),t(e).parent().append(t("<br>")).append(c)}},addClock:function(e){var n=m.clockInputs.length;m.clockInputs[n]=e,m.dismissClockFunc[n]=function(){return m.dismissClock(n),!0};var t=document.createElement("span");t.className=m.shortCutsClass,e.parentNode.insertBefore(t,e.nextSibling);var a=document.createElement("a");a.setAttribute("href","#"),a.appendChild(document.createTextNode(gettext("Now"))),a.addEventListener("click",function(e){e.preventDefault(),m.handleClockQuicklink(n,-1)});var i=document.createElement("a");i.setAttribute("href","#"),i.id=m.clockLinkName+n,i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),m.openClock(n)}),quickElement("span",i,"","class","clock-icon","title",gettext("Choose a Time")),t.appendChild(document.createTextNode(" ")),t.appendChild(a),t.appendChild(document.createTextNode(" | ")),t.appendChild(i);var c=document.createElement("div");c.style.display="none",c.style.position="absolute",c.className="clockbox module",c.setAttribute("id",m.clockDivName+n),document.body.appendChild(c),c.addEventListener("click",function(e){e.stopPropagation()}),quickElement("h2",c,gettext("Choose a time"));var d=quickElement("ul",c);d.className="timelist";var l=void 0===m.clockHours[e.name]?"default_":e.name;m.clockHours[l].forEach(function(t){quickElement("a",quickElement("li",d),gettext(t[0]),"href","#").addEventListener("click",function(e){e.preventDefault(),m.handleClockQuicklink(n,t[1])})});var r=quickElement("p",c);r.className="calendar-cancel",quickElement("a",r,gettext("Cancel"),"href","#").addEventListener("click",function(e){e.preventDefault(),m.dismissClock(n)}),document.addEventListener("keyup",function(e){27===e.which&&(m.dismissClock(n),e.preventDefault())})},openClock:function(e){var t=document.getElementById(m.clockDivName+e),n=document.getElementById(m.clockLinkName+e);"rtl"!==getStyle(document.body,"direction")?t.style.left=findPosX(n)+17+"px":t.style.left=findPosX(n)-110+"px",t.style.top=Math.max(0,findPosY(n)-30)+"px",t.style.display="block",document.addEventListener("click",m.dismissClockFunc[e])},dismissClock:function(e){document.getElementById(m.clockDivName+e).style.display="none",document.removeEventListener("click",m.dismissClockFunc[e])},handleClockQuicklink:function(e,t){var n;n=-1===t?m.now():new Date(1970,1,1,t,0,0,0),m.clockInputs[e].value=n.strftime(get_format("TIME_INPUT_FORMATS")[0]),m.clockInputs[e].focus(),m.dismissClock(e)},addCalendar:function(e){var t=m.calendars.length;m.calendarInputs[t]=e,m.dismissCalendarFunc[t]=function(){return m.dismissCalendar(t),!0};var n=document.createElement("span");n.className=m.shortCutsClass,e.parentNode.insertBefore(n,e.nextSibling);var a=document.createElement("a");a.setAttribute("href","#"),a.appendChild(document.createTextNode(gettext("Today"))),a.addEventListener("click",function(e){e.preventDefault(),m.handleCalendarQuickLink(t,0)});var i=document.createElement("a");i.setAttribute("href","#"),i.id=m.calendarLinkName+t,i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),m.openCalendar(t)}),quickElement("span",i,"","class","date-icon","title",gettext("Choose a Date")),n.appendChild(document.createTextNode(" ")),n.appendChild(a),n.appendChild(document.createTextNode(" | ")),n.appendChild(i);var c=document.createElement("div");c.style.display="none",c.style.position="absolute",c.className="calendarbox module",c.setAttribute("id",m.calendarDivName1+t),document.body.appendChild(c),c.addEventListener("click",function(e){e.stopPropagation()});var d=quickElement("div",c),l=quickElement("a",d,"<","href","#");l.className="calendarnav-previous",l.addEventListener("click",function(e){e.preventDefault(),m.drawPrev(t)});var r=quickElement("a",d,">","href","#");r.className="calendarnav-next",r.addEventListener("click",function(e){e.preventDefault(),m.drawNext(t)}),quickElement("div",c,"","id",m.calendarDivName2+t).className="calendar",m.calendars[t]=new Calendar(m.calendarDivName2+t,m.handleCalendarCallback(t)),m.calendars[t].drawCurrent();var o=quickElement("div",c);o.className="calendar-shortcuts";var s=quickElement("a",o,gettext("Yesterday"),"href","#");s.addEventListener("click",function(e){e.preventDefault(),m.handleCalendarQuickLink(t,-1)}),o.appendChild(document.createTextNode(" | ")),(s=quickElement("a",o,gettext("Today"),"href","#")).addEventListener("click",function(e){e.preventDefault(),m.handleCalendarQuickLink(t,0)}),o.appendChild(document.createTextNode(" | ")),(s=quickElement("a",o,gettext("Tomorrow"),"href","#")).addEventListener("click",function(e){e.preventDefault(),m.handleCalendarQuickLink(t,1)});var u=quickElement("p",c);u.className="calendar-cancel",quickElement("a",u,gettext("Cancel"),"href","#").addEventListener("click",function(e){e.preventDefault(),m.dismissCalendar(t)}),django.jQuery(document).on("keyup",function(e){27===e.which&&(m.dismissCalendar(t),e.preventDefault())})},openCalendar:function(e){var t=document.getElementById(m.calendarDivName1+e),n=document.getElementById(m.calendarLinkName+e),a=m.calendarInputs[e];if(a.value){var i=get_format("DATE_INPUT_FORMATS")[0],c=a.value.strptime(i),d=c.getUTCFullYear(),l=c.getUTCMonth()+1;/\d{4}/.test(d.toString())&&1<=l&&l<=12&&m.calendars[e].drawDate(l,d,c)}"rtl"!==getStyle(document.body,"direction")?t.style.left=findPosX(n)+17+"px":t.style.left=findPosX(n)-180+"px",t.style.top=Math.max(0,findPosY(n)-75)+"px",t.style.display="block",document.addEventListener("click",m.dismissCalendarFunc[e])},dismissCalendar:function(e){document.getElementById(m.calendarDivName1+e).style.display="none",document.removeEventListener("click",m.dismissCalendarFunc[e])},drawPrev:function(e){m.calendars[e].drawPreviousMonth()},drawNext:function(e){m.calendars[e].drawNextMonth()},handleCalendarCallback:function(a){var i=get_format("DATE_INPUT_FORMATS")[0];return i=(i=(i=(i=(i=i.replace("\\","\\\\")).replace("\r","\\r")).replace("\n","\\n")).replace("\t","\\t")).replace("'","\\'"),function(e,t,n){m.calendarInputs[a].value=new Date(e,t-1,n).strftime(i),m.calendarInputs[a].focus(),document.getElementById(m.calendarDivName1+a).style.display="none"}},handleCalendarQuickLink:function(e,t){var n=m.now();n.setDate(n.getDate()+t),m.calendarInputs[e].value=n.strftime(get_format("DATE_INPUT_FORMATS")[0]),m.calendarInputs[e].focus(),m.dismissCalendar(e)}};window.addEventListener("load",m.init),window.DateTimeShortcuts=m}();